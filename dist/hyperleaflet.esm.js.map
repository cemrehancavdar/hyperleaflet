{"version":3,"file":"hyperleaflet.esm.js","sources":["../src/hyperchange.js","../src/geometry.js","../src/hyperleaflet.js","../src/index.js"],"sourcesContent":["/**\n * HyperChange — MutationObserver diffing for hypermedia apps.\n *\n * Watches a DOM subtree and emits semantic add/remove/change events\n * by diffing nodes against a unique key attribute. Designed for use\n * with htmx, Turbo, LiveView, or any server-rendered HTML workflow\n * that swaps DOM content and needs to sync with imperative JS libraries.\n *\n * Internal module — not published as a separate package.\n */\n\nconst VALID_EVENTS = ['add', 'remove', 'change'];\n\nexport class HyperChange {\n  /**\n   * @param {HTMLElement} root — container element to observe\n   * @param {object} options\n   * @param {string} options.key — attribute name used as unique identifier (e.g. 'data-id')\n   * @param {string[]} [options.watch=[]] — attributes to track for change detection\n   * @param {boolean} [options.batch=false] — batch mutations per animation frame\n   */\n  constructor(root, options) {\n    if (!root || !(root instanceof HTMLElement)) {\n      throw new Error('HyperChange: root must be an HTMLElement');\n    }\n    if (!options || !options.key) {\n      throw new Error('HyperChange: options.key is required');\n    }\n\n    this._root = root;\n    this._key = options.key;\n    this._watch = options.watch || [];\n    this._batch = options.batch || false;\n    this._listeners = { add: [], remove: [], change: [] };\n    this._frameId = null;\n    this._pendingMutations = [];\n    this._disconnected = false;\n\n    const hasWatch = this._watch.length > 0;\n\n    this._observer = new MutationObserver((mutations) => {\n      if (this._batch) {\n        this._pendingMutations.push(...mutations);\n        if (this._frameId === null) {\n          this._frameId = requestAnimationFrame(() => {\n            this._frameId = null;\n            const batch = this._pendingMutations.splice(0);\n            this._process(batch);\n          });\n        }\n      } else {\n        this._process(mutations);\n      }\n    });\n\n    this._observer.observe(root, {\n      childList: true,\n      subtree: true,\n      attributes: hasWatch,\n      attributeFilter: hasWatch ? this._watch : undefined,\n      attributeOldValue: hasWatch,\n    });\n  }\n\n  /**\n   * Subscribe to an event.\n   * @param {'add'|'remove'|'change'} event\n   * @param {function} handler\n   * @returns {function} unsubscribe function\n   */\n  on(event, handler) {\n    if (this._disconnected) {\n      throw new Error('HyperChange: cannot subscribe after disconnect');\n    }\n    if (!VALID_EVENTS.includes(event)) {\n      throw new Error(\n        'HyperChange: invalid event \"' + event + '\". Must be one of: ' + VALID_EVENTS.join(', ')\n      );\n    }\n    this._listeners[event].push(handler);\n    return () => {\n      this._listeners[event] = this._listeners[event].filter((h) => h !== handler);\n    };\n  }\n\n  /**\n   * Remove a specific handler.\n   * @param {'add'|'remove'|'change'} event\n   * @param {function} handler\n   */\n  off(event, handler) {\n    if (this._listeners[event]) {\n      this._listeners[event] = this._listeners[event].filter((h) => h !== handler);\n    }\n  }\n\n  /**\n   * Fire 'add' events for all existing keyed children.\n   * Useful for initial state — call after setting up handlers.\n   */\n  scan() {\n    const nodes = this._collectKeyedNodes(this._root);\n    if (nodes.length > 0) {\n      this._emit('add', nodes.map((node) => ({\n        node,\n        key: node.getAttribute(this._key),\n      })));\n    }\n  }\n\n  /**\n   * Stop observing. Clears all listeners. Instance is unusable after this.\n   */\n  disconnect() {\n    this._disconnected = true;\n    this._observer.disconnect();\n    if (this._frameId !== null) {\n      cancelAnimationFrame(this._frameId);\n      this._frameId = null;\n    }\n    this._pendingMutations = [];\n    this._listeners = { add: [], remove: [], change: [] };\n  }\n\n  // --- Private ---\n\n  /**\n   * Iteratively find all elements with the key attribute under a root.\n   * Uses a stack instead of recursion to avoid stack overflow on deep trees.\n   */\n  _collectKeyedNodes(root) {\n    const result = [];\n    const stack = [];\n\n    // Push root's children onto stack (reverse order so first child is processed first)\n    for (let i = root.childNodes.length - 1; i >= 0; i--) {\n      stack.push(root.childNodes[i]);\n    }\n\n    while (stack.length > 0) {\n      const node = stack.pop();\n      if (node.nodeType !== 1) continue;\n      if (node.hasAttribute(this._key)) result.push(node);\n      for (let i = node.childNodes.length - 1; i >= 0; i--) {\n        stack.push(node.childNodes[i]);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Collect keyed nodes from a NodeList (used for MutationRecord addedNodes/removedNodes).\n   */\n  _collectKeyedFromNodeList(nodeList) {\n    const result = [];\n    for (const node of nodeList) {\n      if (node.nodeType !== 1) continue;\n      if (node.hasAttribute(this._key)) result.push(node);\n      // Also check descendants — a parent element may contain keyed children\n      const stack = [];\n      for (let i = node.childNodes.length - 1; i >= 0; i--) {\n        stack.push(node.childNodes[i]);\n      }\n      while (stack.length > 0) {\n        const child = stack.pop();\n        if (child.nodeType !== 1) continue;\n        if (child.hasAttribute(this._key)) result.push(child);\n        for (let i = child.childNodes.length - 1; i >= 0; i--) {\n          stack.push(child.childNodes[i]);\n        }\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Process a batch of MutationRecords into semantic add/remove/change events.\n   */\n  _process(mutations) {\n    if (this._disconnected) return;\n\n    const { removed, added, attrChanges } = this._collectFromMutations(mutations);\n    const { reallyAdded, reallyRemoved, swapChanges } = this._diff(removed, added);\n\n    const allChanges = attrChanges.length > 0 || swapChanges.length > 0\n      ? [...attrChanges, ...swapChanges]\n      : [];\n\n    if (reallyAdded.length > 0) this._emit('add', reallyAdded);\n    if (reallyRemoved.length > 0) this._emit('remove', reallyRemoved);\n    if (allChanges.length > 0) this._emit('change', allChanges);\n  }\n\n  /**\n   * Extract keyed nodes and attribute changes from raw MutationRecords.\n   */\n  _collectFromMutations(mutations) {\n    const removed = [];\n    const added = [];\n    const attrChanges = [];\n\n    for (const mutation of mutations) {\n      if (mutation.type === 'childList') {\n        if (mutation.removedNodes.length > 0) {\n          removed.push(...this._collectKeyedFromNodeList(mutation.removedNodes));\n        }\n        if (mutation.addedNodes.length > 0) {\n          added.push(...this._collectKeyedFromNodeList(mutation.addedNodes));\n        }\n      } else if (mutation.type === 'attributes') {\n        const target = mutation.target;\n        if (!target.hasAttribute(this._key)) continue;\n        attrChanges.push({\n          node: target,\n          key: target.getAttribute(this._key),\n          attribute: mutation.attributeName,\n          from: mutation.oldValue,\n          to: target.getAttribute(mutation.attributeName),\n        });\n      }\n    }\n\n    return { removed, added, attrChanges };\n  }\n\n  /**\n   * Diff added/removed nodes by key to distinguish real adds/removes\n   * from innerHTML swap shuffles where the same key exists in both sets.\n   */\n  _diff(removed, added) {\n    const removedMap = new Map();\n    for (const node of removed) {\n      const key = node.getAttribute(this._key);\n      removedMap.set(key, node);\n    }\n\n    const addedMap = new Map();\n    for (const node of added) {\n      const key = node.getAttribute(this._key);\n      addedMap.set(key, node);\n    }\n\n    // Keys present in both maps = same item swapped (innerHTML replace)\n    const matchedKeys = new Set();\n    const swapChanges = [];\n\n    for (const [key, newNode] of addedMap) {\n      const oldNode = removedMap.get(key);\n      if (!oldNode) continue;\n\n      matchedKeys.add(key);\n\n      // Compare watched attributes between old and new node\n      for (const attr of this._watch) {\n        const oldVal = oldNode.getAttribute(attr);\n        const newVal = newNode.getAttribute(attr);\n        if (oldVal !== newVal) {\n          swapChanges.push({\n            node: newNode,\n            key,\n            attribute: attr,\n            from: oldVal,\n            to: newVal,\n          });\n        }\n      }\n    }\n\n    const reallyAdded = [];\n    for (const [key, node] of addedMap) {\n      if (!matchedKeys.has(key)) {\n        reallyAdded.push({ node, key });\n      }\n    }\n\n    const reallyRemoved = [];\n    for (const [key, node] of removedMap) {\n      if (!matchedKeys.has(key)) {\n        reallyRemoved.push({ node, key });\n      }\n    }\n\n    return { reallyAdded, reallyRemoved, swapChanges };\n  }\n\n  /**\n   * Emit an event to all listeners, with error isolation.\n   */\n  _emit(event, entries) {\n    for (const handler of this._listeners[event]) {\n      try {\n        handler(entries);\n      } catch (err) {\n        console.error('HyperChange: error in \"' + event + '\" handler:', err);\n      }\n    }\n  }\n}\n","/**\n * Geometry — create, update, remove Leaflet objects from data attributes.\n *\n * Merged from old Geometry/geometry.js + Geometry/events.js.\n * No global Config dependency — receives options/eventTarget from hyperleaflet.js.\n */\n\nimport * as L from 'leaflet';\n\n// --- Coordinate parsing ---\n\nfunction parseGeometry(raw) {\n  if (typeof raw === 'string') {\n    try {\n      return JSON.parse(raw);\n    } catch {\n      console.warn('hyperleaflet: failed to parse geometry string:', raw);\n      return null;\n    }\n  }\n  return null;\n}\n\n// --- Geometry type registry ---\n\nconst GEOMETRY_TYPES = {\n  point: {\n    create: (coords, style) => L.marker(coords, style),\n    update: (obj, coords) => obj.setLatLng(coords),\n    convert: (coords, lonLat) => (lonLat ? [...coords].reverse() : coords),\n    eventShape: 'mono',\n  },\n  linestring: {\n    create: (coords, style) => L.polyline(coords, style),\n    update: (obj, coords) => obj.setLatLngs(coords),\n    convert: (coords, lonLat) => (lonLat ? L.GeoJSON.coordsToLatLngs(coords, 0) : coords),\n    eventShape: 'poly',\n  },\n  polygon: {\n    create: (coords, style) => L.polygon(coords, style),\n    update: (obj, coords) => obj.setLatLngs(coords),\n    convert: (coords, lonLat) => (lonLat ? L.GeoJSON.coordsToLatLngs(coords, 1) : coords),\n    eventShape: 'poly',\n  },\n};\n\n/**\n * Register a custom geometry type.\n * @param {string} type — lowercase type name\n * @param {{ create, update, convert }} handlers\n */\nexport function addGeometryType(type, handlers) {\n  if (!handlers.create || !handlers.update || !handlers.convert) {\n    throw new Error('Invalid handlers provided.');\n  }\n  GEOMETRY_TYPES[type] = handlers;\n}\n\n// --- Internal helpers ---\n\nfunction shouldReverse(globalReverse, elementReverse) {\n  return globalReverse || elementReverse !== undefined;\n}\n\nfunction bindPopupAndTooltip(leafletObj, popup, tooltip) {\n  if (popup) leafletObj.bindPopup(popup);\n  if (tooltip) leafletObj.bindTooltip(tooltip);\n}\n\nfunction attachClickEvent(leafletObj, id, shape, eventTarget, eventsEnabled) {\n  if (!eventsEnabled) return;\n\n  if (shape === 'mono') {\n    leafletObj.on('click', (e) => {\n      eventTarget.dispatchEvent(\n        new CustomEvent('geometry:click', {\n          detail: { clickedPoint: e.latlng, geometry: leafletObj.getLatLng(), id },\n        }),\n      );\n    });\n  } else if (shape === 'poly') {\n    leafletObj.on('click', (e) => {\n      eventTarget.dispatchEvent(\n        new CustomEvent('geometry:click', {\n          detail: { clickedPoint: e.latlng, geometry: leafletObj.getLatLngs(), id },\n        }),\n      );\n    });\n  }\n}\n\n// --- Public API ---\n\n/**\n * Create a Leaflet geometry object from a DOM element's dataset.\n *\n * @param {DOMStringMap} dataset — the element's dataset\n * @param {object} opts\n * @param {boolean} opts.reverseCoordinateOrder — global lon/lat flag\n * @param {object} opts.styles — style lookup { geometryType: { styleName: styleObj } }\n * @param {EventTarget} opts.eventTarget — where to dispatch geometry:click\n * @param {boolean} opts.geometryClickEnabled — whether geometry:click is on\n * @returns {L.Layer}\n */\nexport function createGeometry(dataset, opts) {\n  const { geometry: rawGeometry, geometryType, style, popup, tooltip, id, reverseOrder } = dataset;\n  const coords = parseGeometry(rawGeometry);\n  const typeLower = geometryType.toLowerCase();\n  const typeInfo = GEOMETRY_TYPES[typeLower];\n\n  if (!typeInfo) {\n    throw new Error(`Invalid geometry type: ${geometryType}`);\n  }\n\n  const lonLat = shouldReverse(opts.reverseCoordinateOrder, reverseOrder);\n  const converted = typeInfo.convert(coords, lonLat);\n  const computedStyle = opts.styles?.[typeLower]?.[style];\n\n  const leafletObj = typeInfo.create(converted, computedStyle);\n  bindPopupAndTooltip(leafletObj, popup, tooltip);\n  attachClickEvent(leafletObj, id, typeInfo.eventShape, opts.eventTarget, opts.geometryClickEnabled);\n\n  return leafletObj;\n}\n\n/**\n * Update an existing Leaflet geometry's position/shape.\n *\n * @param {L.Layer} leafletObj — existing Leaflet layer\n * @param {DOMStringMap} dataset — the element's updated dataset\n * @param {object} opts\n * @param {boolean} opts.reverseCoordinateOrder — global lon/lat flag\n */\nexport function updateGeometry(leafletObj, dataset, opts) {\n  const { geometry: rawGeometry, geometryType, reverseOrder } = dataset;\n  const coords = parseGeometry(rawGeometry);\n  const typeLower = geometryType.toLowerCase();\n  const typeInfo = GEOMETRY_TYPES[typeLower];\n\n  if (!typeInfo) {\n    throw new Error(`Invalid geometry type: ${geometryType}`);\n  }\n\n  const lonLat = shouldReverse(opts.reverseCoordinateOrder, reverseOrder);\n  const converted = typeInfo.convert(coords, lonLat);\n  return typeInfo.update(leafletObj, converted);\n}\n","/**\n * Hyperleaflet — main module.\n *\n * Merges: Map creation, tile layers, layer groups, map events,\n * geometry handler, config, and HyperChange wiring.\n *\n * No extension hooks. No custom EventTarget polyfill.\n * No deep-merge utility. No separate config module.\n */\n\nimport * as L from 'leaflet';\nimport { HyperChange } from './hyperchange';\nimport { createGeometry, updateGeometry, addGeometryType } from './geometry';\n\n// --- Default options ---\n\nconst DEFAULT_OPTIONS = {\n  reverseCoordinateOrder: false,\n  mapElement: '#map',\n  events: {\n    target: 'window',\n    map: {\n      click: true,\n      dblclick: false,\n      mousedown: false,\n      mouseover: false,\n      mousemove: false,\n      mouseout: false,\n      contextmenu: false,\n      preclick: false,\n      zoom: true,\n      move: true,\n      zoomstart: false,\n      zoomend: false,\n      movestart: false,\n      moveend: false,\n      ready: true,\n    },\n    geometry: {\n      click: true,\n      move: false,\n      add: false,\n    },\n    hyperleaflet: {\n      ready: true,\n    },\n  },\n  styles: {},\n};\n\nfunction mergeDeep(target, source) {\n  const out = { ...target };\n  for (const key of Object.keys(source)) {\n    if (\n      source[key] &&\n      typeof source[key] === 'object' &&\n      !Array.isArray(source[key]) &&\n      target[key] &&\n      typeof target[key] === 'object' &&\n      !Array.isArray(target[key])\n    ) {\n      out[key] = mergeDeep(target[key], source[key]);\n    } else {\n      out[key] = source[key];\n    }\n  }\n  return out;\n}\n\n// --- Config (inline, no separate module) ---\n\nconst config = {\n  _hyperleaflet: null,\n  _options: { ...DEFAULT_OPTIONS, events: JSON.parse(JSON.stringify(DEFAULT_OPTIONS.events)) },\n\n  get options() {\n    return this._options;\n  },\n\n  set options(opts) {\n    this._options = mergeDeep(this._options, opts);\n  },\n\n  reset() {\n    this._options = { ...DEFAULT_OPTIONS, events: JSON.parse(JSON.stringify(DEFAULT_OPTIONS.events)) };\n  },\n\n  getTarget() {\n    const { target } = this._options.events;\n    switch (target) {\n      case 'window':\n        return window;\n      case 'document':\n        return document;\n      case 'hyperleaflet':\n      default:\n        return this._hyperleaflet;\n    }\n  },\n};\n\n// --- Built-in tile layers ---\n\nconst BUILT_IN_TILES = {\n  OpenStreetMap: L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\n    attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n  }),\n  EsriWorldImagery: L.tileLayer(\n    'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\n    {\n      attribution:\n        'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',\n    },\n  ),\n};\n\nfunction registerTileLayer(name, { url, minZoom = 0, maxZoom = 18, tms } = {}) {\n  if (BUILT_IN_TILES[name]) return;\n  BUILT_IN_TILES[name] = new L.TileLayer(url, { minZoom, maxZoom, tms: !!tms });\n}\n\nfunction parseTileElements(tileNodeList) {\n  const tileList = Array.from(tileNodeList);\n  const tiles = [];\n\n  for (const el of tileList) {\n    const name = el.dataset.tile;\n    if (!(name in BUILT_IN_TILES)) {\n      const { tileUrl, tms, minZoom, maxZoom } = el.dataset;\n      registerTileLayer(name, { url: tileUrl, tms, minZoom, maxZoom });\n    }\n    tiles.push({ name, tile: BUILT_IN_TILES[name] });\n  }\n\n  // Find default tile\n  const defaultEl = tileList.find((t) => 'defaultTile' in t.dataset);\n  let defaultTile;\n  if (defaultEl && defaultEl.dataset.tile in BUILT_IN_TILES) {\n    defaultTile = BUILT_IN_TILES[defaultEl.dataset.tile];\n  } else if (tileList.length && tileList[0].dataset.tile in BUILT_IN_TILES) {\n    defaultTile = BUILT_IN_TILES[tileList[0].dataset.tile];\n  } else {\n    defaultTile = BUILT_IN_TILES.OpenStreetMap;\n  }\n\n  return { defaultTile, tiles };\n}\n\n// --- Layer groups ---\n\nconst layerGroups = {};\n\nfunction getLayerGroup(name) {\n  return layerGroups[name];\n}\n\nfunction createLayerGroup(name, layerControl) {\n  const group = L.layerGroup();\n  layerGroups[name] = group;\n  layerControl.addOverlay(group, name);\n  return group;\n}\n\nfunction deleteLayerGroupIfEmpty(name, layerControl) {\n  if (!name || !layerGroups[name]) return;\n  if (layerGroups[name].getLayers().length) return;\n  const group = layerGroups[name];\n  delete layerGroups[name];\n  layerControl.removeLayer(group);\n}\n\n// --- Map creation ---\n\nfunction safeParsePoint(raw, reverse) {\n  try {\n    const point = JSON.parse(raw);\n    return reverse ? point.reverse() : point;\n  } catch {\n    return [0, 0];\n  }\n}\n\nfunction createMap(container) {\n  const { mapConfig } = container.dataset;\n  const target = mapConfig ? document.querySelector(mapConfig) : container;\n  if (!target) throw new Error('hyperleaflet: no map config found');\n\n  const { center, zoom, minZoom, maxZoom } = target.dataset;\n  const reverse = config.options.reverseCoordinateOrder;\n\n  const leafletMap = L.map(container, {\n    center: safeParsePoint(center, reverse),\n    zoom: zoom || 1,\n    minZoom: minZoom || 0,\n    maxZoom: maxZoom || 18,\n  });\n\n  return [leafletMap, target];\n}\n\n// --- Map events ---\n\nconst STATE_EVENTS = ['zoomstart', 'zoomend', 'movestart', 'moveend', 'zoom', 'move'];\nconst MOUSE_EVENTS = ['click', 'dblclick', 'mousedown', 'mouseover', 'mouseout', 'mousemove', 'contextmenu', 'preclick'];\n\nfunction createStateEvent(map, name, leafletEvent) {\n  const bounds = map.getBounds();\n  return new CustomEvent(name, {\n    detail: {\n      zoom: map.getZoom(),\n      center: map.getCenter(),\n      bbox: { min: bounds.getSouthWest(), max: bounds.getNorthEast() },\n      bboxString: bounds.toBBoxString(),\n      _leafletEvent: leafletEvent,\n    },\n  });\n}\n\nfunction bindMapEvents(map, eventTarget) {\n  const mapEvents = config.options.events.map;\n\n  for (const [name, enabled] of Object.entries(mapEvents)) {\n    if (!enabled) continue;\n\n    if (STATE_EVENTS.includes(name)) {\n      map.on(name, (e) => eventTarget.dispatchEvent(createStateEvent(map, `map:${name}`, e)));\n    }\n    if (MOUSE_EVENTS.includes(name)) {\n      map.on(name, (e) => {\n        eventTarget.dispatchEvent(\n          new CustomEvent(`map:${name}`, { detail: { point: e.latlng, _leafletEvent: e } }),\n        );\n      });\n    }\n  }\n\n  if (mapEvents.ready) {\n    map.whenReady(() => eventTarget.dispatchEvent(createStateEvent(map, 'map:ready')));\n  }\n}\n\nfunction sendHyperleafletReady(map, eventTarget) {\n  if (!config.options.events.hyperleaflet.ready) return;\n  const bounds = map.getBounds();\n  eventTarget.dispatchEvent(\n    new CustomEvent('hyperleaflet:ready', {\n      detail: {\n        zoom: map.getZoom(),\n        center: map.getCenter(),\n        bbox: { min: bounds.getSouthWest(), max: bounds.getNorthEast() },\n        bboxString: bounds.toBBoxString(),\n      },\n    }),\n  );\n}\n\n// --- Geometry handler (fixed: uses HyperChange API correctly) ---\n\n// O(1) lookup by data-id instead of O(n) layer scan\nconst geometryIndex = new Map();\n\nfunction addNode(node, map, layerControl) {\n  const { dataset } = node;\n  const { layerName, id } = dataset;\n\n  let target = map;\n  if (layerName) {\n    const existing = getLayerGroup(layerName);\n    if (existing) {\n      target = existing;\n    } else {\n      target = createLayerGroup(layerName, layerControl);\n      target.addTo(map);\n    }\n  }\n\n  const opts = {\n    reverseCoordinateOrder: config.options.reverseCoordinateOrder,\n    styles: config.options.styles,\n    eventTarget: config.getTarget(),\n    geometryClickEnabled: config.options.events.geometry.click,\n  };\n\n  const leafletObj = createGeometry(dataset, opts);\n  leafletObj.hlID = id;\n  leafletObj.addTo(target);\n  geometryIndex.set(id, { layer: leafletObj, target });\n}\n\nfunction removeNode(node, layerControl) {\n  const id = node.dataset.id;\n  const entry = geometryIndex.get(id);\n  if (!entry) return;\n\n  entry.target.removeLayer(entry.layer);\n  geometryIndex.delete(id);\n\n  const layerName = node.dataset.layerName;\n  deleteLayerGroupIfEmpty(layerName, layerControl);\n}\n\n/**\n * Handle attribute change from HyperChange.\n * HyperChange emits: { node, key, attribute, from, to }\n * Old code incorrectly accessed change['data-id'] and change.dataset — FIXED.\n */\nfunction changeNode(change) {\n  const id = change.key;\n  const entry = geometryIndex.get(id);\n  if (!entry) return;\n\n  if (change.attribute === 'data-geometry') {\n    const opts = {\n      reverseCoordinateOrder: config.options.reverseCoordinateOrder,\n    };\n    updateGeometry(entry.layer, change.node.dataset, opts);\n  }\n  // Other attribute changes could be handled here in the future\n}\n\n// --- Hyperleaflet object ---\n\nconst HYPERLEAFLET_DATA_SOURCE = '[data-hyperleaflet-source]';\n\nexport const Hyperleaflet = {\n  map: null,\n  target: null,\n  _hyperchange: null,\n  _layerControl: null,\n\n  initialize(mapContainer) {\n    if (!mapContainer) {\n      console.warn('hyperleaflet: no map container found.');\n      return;\n    }\n    mapContainer.setAttribute('hyperleaflet', '');\n\n    const eventTarget = config.getTarget();\n    const [map, target] = createMap(mapContainer);\n    this.map = map;\n    this.target = target;\n\n    // Tile layers + layer control\n    this._layerControl = L.control.layers();\n    this._layerControl.addTo(map);\n\n    const tileElements = mapContainer.querySelectorAll('[data-tile]');\n    const { defaultTile, tiles } = parseTileElements(tileElements);\n\n    for (const { name, tile } of tiles) {\n      this._layerControl.addBaseLayer(tile, name);\n    }\n    defaultTile.addTo(map);\n\n    // Map events\n    bindMapEvents(map, eventTarget);\n\n    // Wire up data source\n    this._initDataSource(eventTarget);\n\n    // Ready event\n    sendHyperleafletReady(map, eventTarget);\n  },\n\n  _initDataSource(eventTarget) {\n    const source = document.querySelector(HYPERLEAFLET_DATA_SOURCE);\n    if (!source) return;\n\n    const layerControl = this._layerControl;\n    const map = this.map;\n\n    this._hyperchange = new HyperChange(source, {\n      key: 'data-id',\n      watch: ['data-geometry'],\n    });\n\n    this._hyperchange.on('add', (entries) => {\n      for (const entry of entries) {\n        addNode(entry.node, map, layerControl);\n      }\n    });\n\n    this._hyperchange.on('remove', (entries) => {\n      for (const entry of entries) {\n        removeNode(entry.node, layerControl);\n      }\n    });\n\n    this._hyperchange.on('change', (entries) => {\n      for (const entry of entries) {\n        changeNode(entry);\n      }\n    });\n\n    // Process initial elements already in the DOM\n    map.whenReady(() => {\n      this._hyperchange.scan();\n    });\n  },\n\n  // --- Public API ---\n\n  getZoom() {\n    return this.map.getZoom();\n  },\n  setZoom(zoom) {\n    this.map.setZoom(zoom);\n  },\n  getCenter() {\n    return this.map.getCenter();\n  },\n  getBounds() {\n    return this.map.getBounds();\n  },\n  getBBoxString() {\n    return this.map.getBounds().toBBoxString();\n  },\n  panTo(center) {\n    this.map.panTo(center);\n  },\n  flyTo(center, zoom) {\n    this.map.flyTo(center, zoom || this.map.getZoom());\n  },\n  flyToBounds(bounds) {\n    this.map.flyToBounds(bounds);\n  },\n  fitBounds(bounds) {\n    this.map.fitBounds(bounds);\n  },\n\n  addGeometryType(type, handlers) {\n    addGeometryType(type, handlers);\n  },\n};\n\n// Expose config on Hyperleaflet\nHyperleaflet.config = config;\nconfig._hyperleaflet = Hyperleaflet;\n\n// Make Hyperleaflet act as an EventTarget for addEventListener/removeEventListener/dispatchEvent\nconst _eventListeners = {};\n\nHyperleaflet.addEventListener = function (type, listener) {\n  if (!(type in _eventListeners)) _eventListeners[type] = [];\n  _eventListeners[type].push(listener);\n};\n\nHyperleaflet.removeEventListener = function (type, listener) {\n  if (!(type in _eventListeners)) return;\n  const idx = _eventListeners[type].indexOf(listener);\n  if (idx !== -1) _eventListeners[type].splice(idx, 1);\n};\n\nHyperleaflet.dispatchEvent = function (event) {\n  if (!(event.type in _eventListeners)) return true;\n  for (const listener of _eventListeners[event.type].slice()) {\n    listener.call(Hyperleaflet, event);\n  }\n  return !event.defaultPrevented;\n};\n","/**\n * Hyperleaflet entry point.\n *\n * Auto-initializes on DOMContentLoaded. If #map isn't in the DOM yet\n * (SPA routing), watches for it with a body MutationObserver.\n */\n\nimport { Hyperleaflet } from './hyperleaflet';\n\nfunction initializeMap() {\n  const container = document.querySelector(Hyperleaflet.config.options.mapElement);\n  if (container) {\n    Hyperleaflet.initialize(container);\n    return true;\n  }\n  return false;\n}\n\nfunction observeMap() {\n  const observer = new MutationObserver((_mutations, obs) => {\n    if (initializeMap()) {\n      obs.disconnect();\n    }\n  });\n  observer.observe(document.body, { childList: true, subtree: true });\n}\n\n(function () {\n  document.addEventListener('DOMContentLoaded', () => {\n    if (!initializeMap()) {\n      observeMap();\n    }\n  });\n})();\n\nwindow.hyperleaflet = Hyperleaflet;\nexport { Hyperleaflet as hyperleaflet };\n"],"names":["VALID_EVENTS","HyperChange","root","options","_this","HTMLElement","Error","key","_root","_key","_watch","watch","_batch","batch","_listeners","add","remove","change","_frameId","_pendingMutations","_disconnected","hasWatch","length","_observer","MutationObserver","mutations","_this$_pendingMutatio","push","apply","requestAnimationFrame","splice","_process","observe","childList","subtree","attributes","attributeFilter","undefined","attributeOldValue","_proto","prototype","on","event","handler","_this2","includes","join","filter","h","off","scan","_this3","nodes","_collectKeyedNodes","_emit","map","node","getAttribute","disconnect","cancelAnimationFrame","result","stack","i","childNodes","pop","nodeType","hasAttribute","_collectKeyedFromNodeList","nodeList","_iterator","_createForOfIteratorHelperLoose","_step","done","value","child","_this$_collectFromMut","_collectFromMutations","removed","added","attrChanges","_this$_diff","_diff","reallyAdded","reallyRemoved","swapChanges","allChanges","concat","_iterator2","_step2","mutation","type","removedNodes","addedNodes","target","attribute","attributeName","from","oldValue","to","removedMap","Map","_iterator3","_step3","set","addedMap","_iterator4","_step4","matchedKeys","Set","_iterator5","_step5","_step5$value","newNode","oldNode","get","_iterator8","_step8","attr","oldVal","newVal","_iterator6","_step6","_step6$value","has","_iterator7","_step7","_step7$value","entries","_iterator9","_step9","err","console","error","parseGeometry","raw","JSON","parse","_unused","warn","GEOMETRY_TYPES","point","create","coords","style","L","marker","update","obj","setLatLng","convert","lonLat","reverse","eventShape","linestring","polyline","setLatLngs","GeoJSON","coordsToLatLngs","polygon","addGeometryType","handlers","shouldReverse","globalReverse","elementReverse","bindPopupAndTooltip","leafletObj","popup","tooltip","bindPopup","bindTooltip","attachClickEvent","id","shape","eventTarget","eventsEnabled","e","dispatchEvent","CustomEvent","detail","clickedPoint","latlng","geometry","getLatLng","getLatLngs","createGeometry","dataset","opts","_opts$styles","rawGeometry","geometryType","reverseOrder","typeLower","toLowerCase","typeInfo","reverseCoordinateOrder","converted","computedStyle","styles","geometryClickEnabled","updateGeometry","DEFAULT_OPTIONS","mapElement","events","click","dblclick","mousedown","mouseover","mousemove","mouseout","contextmenu","preclick","zoom","move","zoomstart","zoomend","movestart","moveend","ready","hyperleaflet","mergeDeep","source","out","_extends","_i","_Object$keys","Object","keys","Array","isArray","config","_hyperleaflet","_options","stringify","reset","getTarget","window","document","BUILT_IN_TILES","OpenStreetMap","tileLayer","attribution","EsriWorldImagery","registerTileLayer","name","_temp","_ref","url","_ref$minZoom","minZoom","_ref$maxZoom","maxZoom","tms","TileLayer","parseTileElements","tileNodeList","tileList","tiles","_i2","_tileList","el","tile","_el$dataset","tileUrl","defaultEl","find","t","defaultTile","layerGroups","getLayerGroup","createLayerGroup","layerControl","group","layerGroup","addOverlay","deleteLayerGroupIfEmpty","getLayers","removeLayer","safeParsePoint","createMap","container","mapConfig","querySelector","_target$dataset","center","leafletMap","STATE_EVENTS","MOUSE_EVENTS","createStateEvent","leafletEvent","bounds","getBounds","getZoom","getCenter","bbox","min","getSouthWest","max","getNorthEast","bboxString","toBBoxString","_leafletEvent","bindMapEvents","mapEvents","_loop","_Object$entries$_i","_Object$entries","_i3","enabled","whenReady","sendHyperleafletReady","geometryIndex","addNode","layerName","existing","addTo","hlID","layer","removeNode","entry","changeNode","HYPERLEAFLET_DATA_SOURCE","Hyperleaflet","_hyperchange","_layerControl","initialize","mapContainer","setAttribute","_createMap","control","layers","tileElements","querySelectorAll","_parseTileElements","_step$value","addBaseLayer","_initDataSource","setZoom","getBBoxString","panTo","flyTo","flyToBounds","fitBounds","_eventListeners","addEventListener","listener","removeEventListener","idx","indexOf","slice","call","defaultPrevented","initializeMap","observeMap","observer","_mutations","obs","body"],"mappings":"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"}