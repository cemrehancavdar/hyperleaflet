{"version":3,"file":"hyperleaflet.umd.js","sources":["../src/Hyperchange/hyperchange.js","../src/utils.js","../src/config.js","../src/Map/events.js","../src/Map/map.js","../src/Geometry/events.js","../src/Hyperleaflet/eventTarget.js","../src/Geometry/geometry.js","../src/Layers/layers.js","../src/Layers/tileLayers.js","../src/Hyperleaflet/hyperleaflet.js","../src/Hyperleaflet/events.js","../src/Hyperleaflet/hyperleafletGeometryHandler.js","../src/index.js"],"sourcesContent":["const hyperChangeDetection = {\n  events: {},\n\n  /** @param {{ targetSelector: string, uniqueAttribute: string, attributeFilter: string[] }} options */\n  observe({ targetSelector, uniqueAttribute, attributeFilter }) {\n    if (this.events[targetSelector]) {\n      throw new Error(\"Can't observe the same target twice\");\n    }\n    observeChangesInTarget(targetSelector, uniqueAttribute, attributeFilter);\n    this.events[targetSelector] = {};\n  },\n\n  /** @param {string} targetSelector @param {string} evName @param {Function} callback */\n  subscribe(targetSelector, evName, callback) {\n    this.events[targetSelector][evName] = this.events[targetSelector][evName] || [];\n    this.events[targetSelector][evName].push(callback);\n  },\n\n  /** @param {string} targetSelector @param {string} evName @param {Function} callback */\n  unsubscribe(targetSelector, evName, callback) {\n    if (this.events[targetSelector][evName]) {\n      this.events[targetSelector][evName] = this.events[targetSelector][evName].filter((f) => f !== callback);\n    }\n  },\n\n  /** @param {string} targetSelector @param {string} evName @param {*} data */\n  publish(targetSelector, evName, data) {\n    if (this.events[targetSelector][evName]) {\n      this.events[targetSelector][evName].forEach((f) => f(data));\n    }\n  },\n};\n\nfunction observeChangesInTarget(targetSelector, uniqueAttribute, attributeFilter) {\n  const isEqualNode = (oldNode, newNode, attributes) =>\n    attributes.every((attribute) => oldNode.getAttribute(attribute) === newNode.getAttribute(attribute));\n\n  function findNodesWithAttribute(nodes) {\n    const result = [];\n    nodes.forEach((node) => {\n      if (node.nodeType === 1) {\n        if (node.hasAttribute(uniqueAttribute)) {\n          result.push(node);\n        }\n        result.push(...findNodesWithAttribute(node.childNodes));\n      }\n    });\n    return result;\n  }\n\n  const observer = new MutationObserver((mutationsList) => {\n    const removedNodes = [];\n    const addedNodes = [];\n\n    mutationsList.forEach((mutation) => {\n      if (mutation.type === 'childList') {\n        removedNodes.push(...findNodesWithAttribute(mutation.removedNodes));\n        addedNodes.push(...findNodesWithAttribute(mutation.addedNodes));\n      } else if (mutation.type === 'attributes') {\n        const attribute = mutation.attributeName;\n        const attributeChange = {\n          attribute,\n          from: mutation.oldValue,\n          to: mutation.target.getAttribute(attribute),\n          [uniqueAttribute]: mutation.target.getAttribute(uniqueAttribute),\n        };\n        const changedNode = [{ dataset: mutation.target.dataset, ...attributeChange }];\n        hyperChangeDetection.publish(targetSelector, 'node_changes', changedNode);\n      }\n    });\n\n    const changedNodes = [];\n    const removedNodeMap = new Map(removedNodes.map((node) => [node.getAttribute(uniqueAttribute), node]));\n    const jointNodeSet = new Set();\n\n    addedNodes.forEach((addNode) => {\n      const addNodeId = addNode.getAttribute(uniqueAttribute);\n      const oldNode = removedNodeMap.get(addNodeId);\n      if (oldNode) {\n        jointNodeSet.add(addNodeId);\n      }\n      if (oldNode && !isEqualNode(oldNode, addNode, attributeFilter)) {\n        const attributeChanges = attributeFilter.reduce((changes, attr) => {\n          const from = oldNode.getAttribute(attr);\n          const to = addNode.getAttribute(attr);\n          if (from !== to) {\n            changes.push({ attribute: attr, from, to, [uniqueAttribute]: addNodeId });\n          }\n          return changes;\n        }, []);\n        changedNodes.push({ ...attributeChanges, dataset: addNode.dataset });\n      }\n    });\n\n    const reallyRemovedNodes = removedNodes.filter((node) => !jointNodeSet.has(node.getAttribute(uniqueAttribute)));\n    const reallyAddedNodes = addedNodes.filter((node) => !jointNodeSet.has(node.getAttribute(uniqueAttribute)));\n\n    if (reallyAddedNodes.length) {\n      hyperChangeDetection.publish(targetSelector, 'node_adds', reallyAddedNodes);\n    }\n    if (changedNodes.length) {\n      hyperChangeDetection.publish(targetSelector, 'node_changes', changedNodes);\n    }\n    if (reallyRemovedNodes.length) {\n      hyperChangeDetection.publish(targetSelector, 'node_removes', reallyRemovedNodes);\n    }\n  });\n\n  const targetNode = document.querySelector(targetSelector);\n  observer.observe(targetNode, {\n    childList: true,\n    subtree: true,\n    attributes: true,\n    attributeFilter,\n    attributeOldValue: true,\n  });\n}\n\nexport default hyperChangeDetection;\n","function isObject(item) {\n  return item && typeof item === 'object' && !Array.isArray(item);\n}\n\nexport function mergeDeep(target, source) {\n  const output = { ...target };\n  if (isObject(target) && isObject(source)) {\n    Object.keys(source).forEach((key) => {\n      if (isObject(source[key])) {\n        if (key in target && isObject(target[key])) {\n          output[key] = mergeDeep(target[key], source[key]);\n        } else {\n          output[key] = source[key];\n        }\n      } else {\n        output[key] = source[key];\n      }\n    });\n  }\n  return output;\n}\n","import { mergeDeep } from './utils';\n\nconst defaultOptions = {\n  reverseCoordinateOrder: false,\n  mapElement: '#map',\n  events: {\n    target: 'window',\n    map: {\n      click: true,\n      dblclick: false,\n      mousedown: false,\n      mouseover: false,\n      mousemove: false,\n      mouseout: false,\n      contextmenu: false,\n      preclick: false,\n      zoom: true,\n      move: true,\n      zoomstart: false,\n      zoomend: false,\n      movestart: false,\n      moveend: false,\n      ready: true,\n    },\n    geometry: {\n      click: true,\n      move: false,\n      add: false,\n    },\n    hyperleaflet: {\n      ready: true,\n    },\n  },\n  styles: {},\n};\nexport const Config = {\n  _hyperleaflet: null,\n  _options: defaultOptions,\n\n  get options() {\n    return this._options;\n  },\n\n  set options(options) {\n    this._options = mergeDeep(this._options, options);\n  },\n\n  reset() {\n    this._options = defaultOptions;\n  },\n\n  getTarget() {\n    const { target } = this.options.events;\n    switch (target) {\n      case 'window':\n        return window;\n      case 'document':\n        return document;\n      case 'hyperleaflet':\n      default:\n        return this._hyperleaflet;\n    }\n  },\n};\n","import { Config } from '../config';\n\nfunction createStateEvent(map, eventName, _leafletEvent) {\n  const bounds = map.getBounds();\n  const min = bounds.getSouthWest();\n  const max = bounds.getNorthEast();\n  const bboxString = bounds.toBBoxString();\n  return new CustomEvent(eventName, {\n    detail: { zoom: map.getZoom(), center: map.getCenter(), bbox: { min, max }, bboxString, _leafletEvent },\n  });\n}\n\nconst stateEvents = ['zoomstart', 'zoomend', 'movestart', 'moveend', 'zoom', 'move'];\nconst mouseEvents = [\n  'click',\n  'dblclick',\n  'mousedown',\n  'mouseover',\n  'mouseout',\n  'mousemove',\n  'contextmenu',\n  'preclick',\n];\n\nexport function setMapEvents(map) {\n  const eventTarget = Config.getTarget('map');\n  const mapEvents = Config.options.events.map;\n  Object.entries(mapEvents).forEach(([eventName, value]) => {\n    if (value) {\n      if (stateEvents.includes(eventName)) {\n        map.on(eventName, (e) => {\n          const event = createStateEvent(map, `map:${eventName}`, e);\n          eventTarget.dispatchEvent(event);\n        });\n      }\n      if (mouseEvents.includes(eventName)) {\n        map.on(eventName, (e) => {\n          const event = new CustomEvent(`map:${eventName}`, { detail: { point: e.latlng }, _leafletEvent: e });\n          eventTarget.dispatchEvent(event);\n        });\n      }\n    }\n  });\n\n  if (mapEvents.ready) {\n    map.whenReady(() => {\n      const event = createStateEvent(map, 'map:ready');\n      eventTarget.dispatchEvent(event);\n    });\n  }\n}\n","import * as L from 'leaflet';\nimport { setMapEvents } from './events';\nimport { Config } from '../config';\n\nfunction reverseCoordinates(point) {\n  return point.reverse();\n}\n\nfunction safeParsePoint(pointJson, reverse = false) {\n  try {\n    const point = JSON.parse(pointJson);\n    return reverse ? reverseCoordinates(point) : point;\n  } catch (_) {\n    return [0, 0];\n  }\n}\n\nexport const Map_ = {\n  map: null,\n  create(mapContainer) {\n    const config = Config;\n    const { mapConfig } = mapContainer.dataset;\n    const target = mapConfig ? document.querySelector(mapConfig) : mapContainer;\n    if (!target) throw new Error('No map config found');\n\n    const { center, zoom, minZoom, maxZoom } = target.dataset;\n\n    const { reverseCoordinateOrder } = config.options;\n    const mapView = {\n      center: safeParsePoint(center, reverseCoordinateOrder),\n      zoom: zoom || 1,\n    };\n    const leafletMap = L.map(mapContainer, {\n      center: mapView.center,\n      zoom: mapView.zoom,\n      minZoom: minZoom || 0,\n      maxZoom: maxZoom || 18,\n    });\n    setMapEvents(leafletMap);\n    return [leafletMap, target];\n  },\n};\n","import { Config } from '../config';\n\nexport function setEvents(leafletObject, id, eventType) {\n  const eventTarget = Config.getTarget('map');\n\n  if (Config.options.events.geometry.click) {\n    if (eventType === 'mono') {\n      leafletObject.on('click', (e) => {\n        const event = new CustomEvent('geometry:click', {\n          detail: { clickedPoint: e.latlng, geometry: leafletObject.getLatLng(), id },\n        });\n        eventTarget.dispatchEvent(event);\n      });\n    } else if (eventType === 'poly') {\n      leafletObject.on('click', (e) => {\n        const event = new CustomEvent('geometry:click', {\n          detail: {\n            clickedPoint: e.latlng,\n            geometry: leafletObject.getLatLngs(),\n            id,\n          },\n        });\n        eventTarget.dispatchEvent(event);\n      });\n    } else {\n      throw new Error('Invalid event type');\n    }\n  }\n}\n\nexport function sendEvent(eventType, leafletGeometry, id, geometryType, target) {\n  const eventTarget = Config.getTarget('map');\n\n  if (Config.options.events.geometry.add) {\n    const event = new CustomEvent(`geometry:${eventType}`, {\n      detail: { id, geometryType, target },\n    });\n    eventTarget.dispatchEvent(event);\n  }\n}\n","function makeEventTarget(object) {\n  const eventListeners = {};\n\n  Object.assign(object, {\n    addEventListener(type, listener) {\n      if (!(type in eventListeners)) {\n        eventListeners[type] = [];\n      }\n      eventListeners[type].push(listener);\n    },\n    removeEventListener(type, listener) {\n      if (!(type in eventListeners)) {\n        return;\n      }\n      const index = eventListeners[type].indexOf(listener);\n      if (index !== -1) {\n        eventListeners[type].splice(index, 1);\n      }\n    },\n    dispatchEvent(event) {\n      if (!(event.type in eventListeners)) {\n        return true;\n      }\n      const listeners = eventListeners[event.type].slice();\n      for (const listener of listeners) {\n        listener.call(object, event);\n      }\n      return !event.defaultPrevented;\n    },\n  });\n}\n\nexport { makeEventTarget };\n","import * as L from 'leaflet';\nimport { setEvents } from './events';\nimport { Config } from '../config';\n\nconst convertGeometryCoordinates = (geometry) => {\n  if (typeof geometry === 'string') {\n    try {\n      return JSON.parse(geometry);\n    } catch (error) {\n      console.warn('Failed to parse the geometry string.');\n      return null;\n    }\n  }\n  return null;\n};\n\nconst createHyperleafletGeometryParams = (dataset) => {\n  const hyperleafletOptions = Config.options;\n  const { geometry, geometryType, style, popup, tooltip, id } = dataset;\n  const { styles } = hyperleafletOptions;\n\n  const convertedGeometry = convertGeometryCoordinates(geometry);\n  const computedStyle = styles?.[geometryType]?.[style];\n\n  const options = {\n    style: computedStyle,\n    popup,\n    tooltip,\n    id,\n  };\n\n  return { geometry: convertedGeometry, geometryType, options };\n};\n\nexport const Geometry = {\n  types: {\n    point: {\n      create: (geometry, styleOptions, _extraParams) => L.marker(geometry, styleOptions),\n      update: (leafletObject, geometry) => leafletObject.setLatLng(geometry),\n      convert: (geometry, isLonLat) => (isLonLat ? [...geometry].reverse() : geometry),\n      eventType: 'mono',\n    },\n    linestring: {\n      create: (geometry, styleOptions, _extraParams) => L.polyline(geometry, styleOptions),\n      update: (leafletObject, geometry) => leafletObject.setLatLngs(geometry),\n      convert: (geometry, isLonLat) => (isLonLat ? L.GeoJSON.coordsToLatLngs(geometry, 0) : geometry),\n      eventType: 'poly',\n    },\n    polygon: {\n      create: (geometry, styleOptions, _extraParams) => L.polygon(geometry, styleOptions),\n      update: (leafletObject, geometry) => leafletObject.setLatLngs(geometry),\n      convert: (geometry, isLonLat) => (isLonLat ? L.GeoJSON.coordsToLatLngs(geometry, 1) : geometry),\n      eventType: 'poly',\n    },\n  },\n\n  addType(type, handlers) {\n    if (!handlers.create || !handlers.update || !handlers.convert) {\n      throw new Error('Invalid handlers provided.');\n    }\n\n    this.types[type] = handlers;\n  },\n\n  shouldReverseCoordinates(reverseCoordinateOrder, reverseOrder) {\n    return reverseCoordinateOrder || reverseOrder !== undefined;\n  },\n  applyPopupAndTooltip(leafletGeometry, options) {\n    if (options.popup) {\n      leafletGeometry.bindPopup(options.popup);\n    }\n    if (options.tooltip) {\n      leafletGeometry.bindTooltip(options.tooltip);\n    }\n  },\n\n  createGeometry(dataset) {\n    const { reverseOrder, ...extraOptions } = dataset;\n    const { reverseCoordinateOrder } = Config.options;\n    const { geometry, geometryType, options } = createHyperleafletGeometryParams(dataset);\n\n    const geometryCreator = this.types[geometryType.toLowerCase()];\n\n    const isLonLat = this.shouldReverseCoordinates(reverseCoordinateOrder, reverseOrder);\n\n    if (!geometryCreator) {\n      throw new Error(`Invalid geometry type: ${geometryType}`);\n    }\n\n    const convertedGeometry = geometryCreator.convert(geometry, isLonLat);\n\n    const leafletGeometry = geometryCreator.create(convertedGeometry, options.style, extraOptions);\n    this.applyPopupAndTooltip(leafletGeometry, options);\n\n    setEvents(leafletGeometry, options.id, geometryCreator.eventType);\n    return leafletGeometry;\n  },\n\n  updateGeometry(leafletObject, dataset) {\n    const { reverseOrder } = dataset;\n    const { reverseCoordinateOrder } = Config.options;\n\n    const isLonLat = this.shouldReverseCoordinates(reverseCoordinateOrder, reverseOrder);\n    const { geometry, geometryType } = createHyperleafletGeometryParams(dataset);\n    const typeInfo = this.types[geometryType.toLowerCase()];\n\n    if (!typeInfo) {\n      throw new Error(`Invalid geometry type: ${geometryType}`);\n    }\n\n    const convertedGeometry = typeInfo.convert(geometry, isLonLat);\n    return typeInfo.update(leafletObject, convertedGeometry);\n  },\n};\n","import * as L from 'leaflet';\n\nexport const Layers = {\n  control: L.control.layers(),\n  layerGroups: {},\n\n  addBaseLayer(baseLayer, layerName) {\n    this.control.addBaseLayer(baseLayer, layerName);\n  },\n  getLayerGroup(layerName) {\n    return this.layerGroups?.[layerName];\n  },\n  createLayerGroup(layerName) {\n    const layerGroup = L.layerGroup();\n    this.layerGroups[layerName] = layerGroup;\n    this.control.addOverlay(layerGroup, layerName);\n    return layerGroup;\n  },\n  deleteLayerGroup(layerName, options = { ifEmpty: false }) {\n    if (options.ifEmpty && this.layerGroups[layerName].getLayers().length) {\n      return;\n    }\n    const layerGroup = this.layerGroups[layerName];\n    delete this.layerGroups[layerName];\n    this.control.removeLayer(layerGroup);\n  },\n};\n","import * as L from 'leaflet';\n\nexport const TileLayers = {\n  _tileLayers: {\n    OpenStreetMap: L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n    }),\n    EsriWorldImagery: L.tileLayer(\n      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',\n      {\n        attribution:\n          'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',\n      },\n    ),\n  },\n  _addTileLayer(name, { url, minZoom = 0, maxZoom = 18, tms } = {}) {\n    if (this._tileLayers[name]) {\n      return;\n    }\n    const newTileLayer = new L.TileLayer(url, { minZoom, maxZoom, tms: !!tms });\n    this._tileLayers[name] = newTileLayer;\n  },\n\n  _getDefaultHyperleafletTile(tileLayerElementList) {\n    const defaultTileLayerElement = tileLayerElementList.find((t) => 'defaultTile' in t.dataset);\n    if (defaultTileLayerElement && defaultTileLayerElement.dataset.tile in this._tileLayers) {\n      return this._tileLayers[defaultTileLayerElement.dataset.tile];\n    }\n    if (tileLayerElementList.length && tileLayerElementList[0].dataset.tile in this._tileLayers) {\n      return this._tileLayers[tileLayerElementList[0].dataset.tile];\n    }\n    return this._tileLayers.OpenStreetMap;\n  },\n\n  tiles: [],\n  defaultTile: undefined,\n  nodesToTiles(tileLayerElementNodeList) {\n    const tileLayerElementList = Array.from(tileLayerElementNodeList);\n    tileLayerElementList.forEach((tileLayerElement) => {\n      const { tile } = tileLayerElement.dataset;\n\n      if (!(tile in this._tileLayers)) {\n        const { tileUrl, tms, minZoom, maxZoom } = tileLayerElement.dataset;\n        this._addTileLayer(tile, { url: tileUrl, tms, minZoom, maxZoom });\n      }\n      this.tiles.push({ name: tile, tile: this._tileLayers[tile] });\n    });\n\n    this.defaultTile = this._getDefaultHyperleafletTile(tileLayerElementList);\n    return {\n      defaultTile: this.defaultTile,\n      tiles: this.tiles,\n    };\n  },\n};\n","import hyperChangeDetection from '../Hyperchange/hyperchange';\n\nimport { Map_ } from '../Map/map';\nimport { createGeometryHandler } from './hyperleafletGeometryHandler';\nimport { sendHyperleafletReady } from './events';\nimport { Geometry } from '../Geometry/geometry';\nimport { Layers } from '../Layers/layers';\nimport { TileLayers } from '../Layers';\nimport { Config } from '../config';\nimport { makeEventTarget } from './eventTarget';\n\nconst HYPERLEAFLET_DATA_SOURCE = '[data-hyperleaflet-source]';\n\nexport const Hyperleaflet = {\n  beforeNodeAdd: [],\n  afterNodeAdd: [],\n  beforeNodeRemove: [],\n  afterNodeRemove: [],\n  beforeNodeChange: [],\n  afterNodeChange: [],\n  addNode: [],\n  removeNode: [],\n  changeNode: [],\n  customMapEvents: [],\n\n  initialize(mapContainer) {\n    if (!mapContainer) {\n      console.warn('Hyperleaflet: No map container found.');\n      return;\n    }\n    mapContainer.setAttribute('hyperleaflet', '');\n    const [map, target] = Map_.create(mapContainer);\n    this.map = map;\n    this.target = target;\n    this.initializeLayerControl(mapContainer, this.map);\n    this.initializeHyperleafletDataSource();\n    this.customMapEvents.forEach((hook) => hook(this.map, this.target));\n    sendHyperleafletReady(this.map);\n  },\n\n  addExtension(extension) {\n    if (extension.layer) {\n      Layers.control.addOverlay(extension.layer);\n    }\n\n    if (extension.handleMap) {\n      this.customMapEvents.push((map, mapTarget) => extension.handleMap(map, mapTarget));\n    }\n\n    const functionNames = [\n      'addNode',\n      'removeNode',\n      'changeNode',\n      'beforeNodeAdd',\n      'afterNodeAdd',\n      'beforeNodeRemove',\n      'afterNodeRemove',\n      'beforeNodeChange',\n      'afterNodeChange',\n    ];\n\n    functionNames.forEach((functionName) => {\n      if (extension[functionName] && typeof extension[functionName] === 'function') {\n        this[functionName].push((node) => extension[functionName](node));\n      }\n    });\n  },\n\n  initializeHyperleafletDataSource() {\n    const hyperleafletDataSource = document.querySelector(HYPERLEAFLET_DATA_SOURCE);\n\n    if (!hyperleafletDataSource) return;\n\n    const { addNodeToHyperleaflet, deleteNodeFromHyperleaflet, changeNodeInHyperleaflet } = createGeometryHandler(\n      this.map,\n      Layers,\n    );\n\n    this.map.whenReady(() => {\n      const nodes = hyperleafletDataSource.querySelectorAll('[data-id]');\n      nodes.forEach((node) => {\n        this.beforeNodeAdd.forEach((hook) => hook(node));\n        if (node.dataset.hyperleafletExtension) {\n          this.addNode.forEach((hook) => hook(node));\n        } else {\n          addNodeToHyperleaflet(node);\n        }\n        this.afterNodeAdd.forEach((hook) => hook(node));\n      });\n    });\n\n    hyperChangeDetection.observe({\n      targetSelector: HYPERLEAFLET_DATA_SOURCE,\n      uniqueAttribute: 'data-id',\n      attributeFilter: ['data-geometry'],\n    });\n\n    hyperChangeDetection.subscribe(HYPERLEAFLET_DATA_SOURCE, 'node_adds', (nodes) => {\n      nodes.forEach((node) => {\n        this.beforeNodeAdd.forEach((hook) => hook(node));\n        if (node.dataset.hyperleafletExtension) {\n          this.addNode.forEach((hook) => hook(node));\n        } else {\n          addNodeToHyperleaflet(node);\n        }\n        this.afterNodeAdd.forEach((hook) => hook(node));\n      });\n    });\n\n    hyperChangeDetection.subscribe(HYPERLEAFLET_DATA_SOURCE, 'node_removes', (nodes) => {\n      nodes.forEach((node) => {\n        this.beforeNodeRemove.forEach((hook) => hook(node));\n        if (node.dataset.hyperleafletExtension) {\n          this.removeNode.forEach((hook) => hook(node));\n        } else {\n          deleteNodeFromHyperleaflet(node);\n        }\n        this.afterNodeRemove.forEach((hook) => hook(node));\n      });\n    });\n\n    hyperChangeDetection.subscribe(HYPERLEAFLET_DATA_SOURCE, 'node_changes', (changes) => {\n      changes.forEach((change) => {\n        this.beforeNodeChange.forEach((hook) => hook(change));\n        if (change.dataset.hyperleafletExtension) {\n          this.changeNode.forEach((hook) => hook(change));\n        } else {\n          changeNodeInHyperleaflet(change);\n        }\n        this.afterNodeChange.forEach((hook) => hook(change));\n      });\n    });\n  },\n\n  initializeLayerControl(mapContainer) {\n    const tileLayerElementList = mapContainer.querySelectorAll('[data-tile]');\n    const { defaultTile, tiles } = TileLayers.nodesToTiles(tileLayerElementList);\n\n    const layerControl = Layers.control;\n    layerControl.addTo(this.map);\n\n    tiles.forEach(({ name, tile }) => {\n      Layers.addBaseLayer(tile, name);\n    });\n\n    defaultTile.addTo(this.map);\n  },\n\n  getZoom() {\n    return this.map.getZoom();\n  },\n\n  setZoom(zoom) {\n    this.map.setZoom(zoom);\n  },\n  getCenter() {\n    return this.map.getCenter();\n  },\n  fitBounds(bounds) {\n    this.map.fitBounds(bounds);\n  },\n  getBounds() {\n    return this.map.getBounds();\n  },\n  getBBoxString() {\n    return this.map.getBounds().toBBoxString();\n  },\n  panTo(center) {\n    this.map.panTo(center);\n  },\n  flyTo(center, zoom = undefined) {\n    zoom = zoom || this.map.getZoom();\n    this.map.flyTo(center, zoom);\n  },\n  flyToBounds(bounds) {\n    this.map.flyToBounds(bounds);\n  },\n};\n\nHyperleaflet.addGeometryType = (type, customGeometryType) => {\n  Geometry.addType(type, customGeometryType);\n};\n\nmakeEventTarget(Hyperleaflet);\n\nHyperleaflet.config = Config;\n\nConfig._hyperleaflet = Hyperleaflet;\n","import { Config } from '../config';\n\nexport function sendHyperleafletReady(map) {\n  const eventTarget = Config.getTarget('hyperleaflet');\n\n  if (Config.options.events.hyperleaflet.ready) {\n    const bounds = map.getBounds();\n    const min = bounds.getSouthWest();\n    const max = bounds.getNorthEast();\n    const bboxString = bounds.toBBoxString();\n    const event = new CustomEvent('hyperleaflet:ready', {\n      detail: { zoom: map.getZoom(), center: map.getCenter(), bbox: { min, max }, bboxString },\n    });\n    eventTarget.dispatchEvent(event);\n  }\n}\n","import { sendEvent } from '../Geometry/events';\nimport { Geometry } from '../Geometry/geometry';\n\nexport function createGeometryHandler(map, layerModule) {\n  function addNodeToHyperleaflet(node) {\n    const {\n      dataset,\n      dataset: { layerName, id },\n    } = node;\n\n    let target = map;\n    if (layerName) {\n      const layer = layerModule.getLayerGroup(layerName);\n      if (!layer) {\n        target = layerModule.createLayerGroup(layerName);\n        target.addTo(map);\n      } else {\n        target = layer;\n      }\n    }\n\n    const leafletGeometry = Geometry.createGeometry(dataset);\n    sendEvent('add', leafletGeometry, id, dataset.geometryType, target);\n    leafletGeometry.hlID = id;\n    leafletGeometry.addTo(target);\n  }\n\n  function deleteNodeFromHyperleaflet(node) {\n    const rowId = node.dataset.id;\n    const { layerName } = node.dataset;\n\n    const layer = layerModule.getLayerGroup(layerName);\n\n    const target = layer || map;\n\n    const leafletLayers = Object.values(target._layers);\n    const leafletObject = leafletLayers.find((_layer) => _layer.hlID === rowId);\n\n    target.removeLayer(leafletObject);\n    sendEvent('remove', leafletObject, rowId, node.dataset.geometryType, target);\n    layerModule.deleteLayerGroup(layerName, { ifEmpty: true });\n  }\n\n  function changeNodeInHyperleaflet(change) {\n    const rowId = change['data-id'];\n\n    const leafletLayers = Object.values(map._layers);\n    const leafletObject = leafletLayers.find((layer) => layer.hlID === rowId);\n\n    switch (change.attribute) {\n      case 'data-geometry': {\n        sendEvent('change', leafletObject, rowId, change.dataset.geometryType, map);\n        return Geometry.updateGeometry(leafletObject, change.dataset);\n      }\n      default: {\n        throw new Error('Unsupported attribute change!');\n      }\n    }\n  }\n\n  return { addNodeToHyperleaflet, deleteNodeFromHyperleaflet, changeNodeInHyperleaflet };\n}\n","import { Hyperleaflet } from './Hyperleaflet';\nimport { Config } from './config';\n\nfunction initializeMap() {\n  const mapContainer = document.querySelector(Config.options.mapElement);\n  if (mapContainer) {\n    Hyperleaflet.initialize(mapContainer);\n    return true;\n  }\n  return false;\n}\n\nfunction observeMap() {\n  const observer = new MutationObserver((_mutations, obs) => {\n    if (initializeMap()) {\n      obs.disconnect();\n    }\n  });\n  observer.observe(document.body, { childList: true, subtree: true });\n}\n\n(function () {\n  document.addEventListener('DOMContentLoaded', () => {\n    if (!initializeMap()) {\n      observeMap();\n    }\n  });\n})();\n\nwindow.hyperleaflet = Hyperleaflet;\nexport { Hyperleaflet as hyperleaflet };\n"],"names":["hyperChangeDetection","events","observe","_ref","targetSelector","uniqueAttribute","attributeFilter","this","Error","findNodesWithAttribute","nodes","result","forEach","node","nodeType","hasAttribute","push","apply","childNodes","observer","MutationObserver","mutationsList","removedNodes","addedNodes","mutation","type","_attributeChange","attribute","attributeName","attributeChange","from","oldValue","to","target","getAttribute","changedNode","_extends","dataset","publish","changedNodes","removedNodeMap","Map","map","jointNodeSet","Set","addNode","addNodeId","oldNode","get","add","newNode","attributes","every","isEqualNode","attributeChanges","reduce","changes","attr","_changes$push","reallyRemovedNodes","filter","has","reallyAddedNodes","length","targetNode","document","querySelector","childList","subtree","attributeOldValue","observeChangesInTarget","subscribe","evName","callback","unsubscribe","f","data","isObject","item","Array","isArray","mergeDeep","source","output","Object","keys","key","defaultOptions","reverseCoordinateOrder","mapElement","click","dblclick","mousedown","mouseover","mousemove","mouseout","contextmenu","preclick","zoom","move","zoomstart","zoomend","movestart","moveend","ready","geometry","hyperleaflet","styles","Config","_hyperleaflet","_options","options","reset","getTarget","window","createStateEvent","eventName","_leafletEvent","bounds","getBounds","min","getSouthWest","max","getNorthEast","bboxString","toBBoxString","CustomEvent","detail","getZoom","center","getCenter","bbox","stateEvents","mouseEvents","safeParsePoint","pointJson","reverse","point","JSON","parse","reverseCoordinates","_","sendEvent","eventType","leafletGeometry","id","geometryType","eventTarget","event","dispatchEvent","object","eventListeners","createHyperleafletGeometryParams","_styles$geometryType","style","popup","tooltip","error","console","warn","convertGeometryCoordinates","Geometry","types","create","styleOptions","_extraParams","L","marker","update","leafletObject","setLatLng","convert","isLonLat","concat","linestring","polyline","setLatLngs","GeoJSON","coordsToLatLngs","polygon","addType","handlers","shouldReverseCoordinates","reverseOrder","undefined","applyPopupAndTooltip","bindPopup","bindTooltip","createGeometry","extraOptions","_objectWithoutPropertiesLoose","_excluded","_createHyperleafletGe","geometryCreator","toLowerCase","convertedGeometry","on","e","clickedPoint","latlng","getLatLng","getLatLngs","setEvents","updateGeometry","_createHyperleafletGe2","typeInfo","Layers","control","layers","layerGroups","addBaseLayer","baseLayer","layerName","getLayerGroup","_this$layerGroups","createLayerGroup","layerGroup","addOverlay","deleteLayerGroup","ifEmpty","getLayers","removeLayer","TileLayers","_tileLayers","OpenStreetMap","tileLayer","attribution","EsriWorldImagery","_addTileLayer","name","_temp","_ref$minZoom","minZoom","_ref$maxZoom","maxZoom","newTileLayer","TileLayer","url","tms","_getDefaultHyperleafletTile","tileLayerElementList","defaultTileLayerElement","find","t","tile","tiles","defaultTile","nodesToTiles","tileLayerElementNodeList","_this","tileLayerElement","_tileLayerElement$dat","tileUrl","HYPERLEAFLET_DATA_SOURCE","Hyperleaflet","beforeNodeAdd","afterNodeAdd","beforeNodeRemove","afterNodeRemove","beforeNodeChange","afterNodeChange","removeNode","changeNode","customMapEvents","initialize","mapContainer","setAttribute","_Map_$create","config","mapConfig","mapEvents","_target$dataset","mapView","leafletMap","entries","includes","whenReady","Map_","initializeLayerControl","initializeHyperleafletDataSource","hook","sendHyperleafletReady","addExtension","extension","_this2","layer","handleMap","mapTarget","functionName","_this3","hyperleafletDataSource","layerModule","_createGeometryHandle","addNodeToHyperleaflet","_node$dataset","addTo","hlID","deleteNodeFromHyperleaflet","rowId","values","_layers","_layer","changeNodeInHyperleaflet","change","querySelectorAll","hyperleafletExtension","_TileLayers$nodesToTi","setZoom","fitBounds","getBBoxString","panTo","flyTo","flyToBounds","initializeMap","addGeometryType","customGeometryType","assign","addEventListener","listener","removeEventListener","index","indexOf","splice","_step","_iterator","_createForOfIteratorHelperLoose","slice","done","value","call","defaultPrevented","_mutations","obs","disconnect","body"],"mappings":"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"}